files:
 "/opt/elasticbeanstalk/hooks/appdeploy/enact/pre_configuration.sh":
  mode: "000755"
  owner: root
  group: root
  content: |
   #!/bin/bash
   
   #download phantomjs
   rm -rf /home/phantomjs
   wget https://s3.amazonaws.com/placeholder-code-deploy/phantomjs/2.1.1/phantomjs -P /home/phantomjs/
   chmod 755 /home/phantomjs/phantomjs
   
   #insert config line into crontab
   if cat /etc/crontab | grep -Fx '*/2 * * * * root sudo bash /opt/elasticbeanstalk/hooks/appdeploy/enact/watchdog.sh'
   then
       echo "The config line is already on crontab."
   else
       echo "Inserting config line into crontab."
       echo "*/2 * * * * root sudo bash /opt/elasticbeanstalk/hooks/appdeploy/enact/watchdog.sh" | sudo tee -a /etc/crontab
   fi
   
   #configure swap
   SWAPFILE=/var/swapfile
   SWAP_MEGABYTES=2048
   if [ -f $SWAPFILE ]; then
     echo "Swapfile $SWAPFILE found, assuming already setup"
     exit;
   fi
   /bin/dd if=/dev/zero of=$SWAPFILE bs=1M count=$SWAP_MEGABYTES
   /bin/chmod 600 $SWAPFILE
   /sbin/mkswap $SWAPFILE
   /sbin/swapon $SWAPFILE